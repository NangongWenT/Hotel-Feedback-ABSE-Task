# 500 错误排查指南

## 🔍 问题描述

访问 `/api/auth/login` 和 `/api/auth/me` 时出现 500 内部服务器错误。

## 🔧 已实施的修复

我已经改进了错误处理，添加了详细的错误日志：

1. **改进了 `/api/auth/login` 的错误处理**
2. **改进了 `/api/auth/me` 的错误处理**
3. **添加了详细的错误日志输出**

## 📋 排查步骤

### 步骤 1：查看后端日志

**查看运行后端的 PowerShell 窗口**，应该能看到详细的错误信息。

常见的错误原因：

1. **数据库连接问题**
   - 错误信息：`unable to open database file`
   - 解决：检查 `data/hotel_feedback.db` 文件是否存在

2. **数据库表不存在**
   - 错误信息：`no such table: users`
   - 解决：重启后端，会自动创建表

3. **模型加载问题**（虽然 auth 不应该需要模型）
   - 错误信息：`模型未在本地找到`
   - 解决：确保模型文件存在

### 步骤 2：测试数据库

运行测试脚本：

```powershell
cd backend
.\venv\Scripts\python.exe test_db.py
```

### 步骤 3：重启后端

**如果数据库有问题，重启后端会自动修复：**

1. 停止当前后端（Ctrl+C）
2. 重新启动：
   ```powershell
   cd "C:\Users\32353\Desktop\大四上\NLP\CW\Hotel-Feedback-ABSA-Task-main\backend"
   .\venv\Scripts\python.exe app.py
   ```

### 步骤 4：检查后端日志

重启后，查看后端窗口的输出，应该能看到：
- 数据库表创建信息
- 默认管理员账户创建信息
- 任何错误信息

## 🔍 常见问题

### Q1: 数据库文件不存在？

**解决：**
```powershell
# 确保目录存在
New-Item -ItemType Directory -Force -Path "data"
```

### Q2: 数据库表不存在？

**解决：**
- 重启后端，会自动创建表
- 或删除 `data/hotel_feedback.db`，重新启动

### Q3: 模型加载失败？

**解决：**
- 确保模型文件存在：`model/cache/Qwen--Qwen2-1.5B-Instruct/model.safetensors`
- 如果不存在，需要下载模型

## 📝 下一步

1. **查看后端日志**，找到具体的错误信息
2. **运行测试脚本**，检查数据库
3. **重启后端**，让修改生效
4. **再次尝试登录**

## 🎯 如果问题仍然存在

请把后端窗口中的**完整错误信息**发给我，我可以更准确地定位问题。

