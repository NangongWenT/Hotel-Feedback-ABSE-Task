# 酒店反馈分析系统 - 运行指南

## ✅ 已安装的软件
- ✅ Python 3.14.0

## ❌ 需要安装的软件

### 1. 安装 Node.js（必需）

**下载地址：** https://nodejs.org/zh-cn/download/

**推荐版本：** LTS 版本（长期支持版）

**安装步骤：**
1. 访问 https://nodejs.org/zh-cn/download/
2. 下载 Windows 安装程序（.msi 文件）
3. 运行安装程序，一路点击"下一步"
4. **重要：** 确保勾选 "Add to PATH" 选项
5. 安装完成后，重启命令行窗口

**验证安装：**
```powershell
node --version
npm --version
```

### 2. （可选）安装 CUDA（如果有 NVIDIA GPU）

如果你有 NVIDIA 显卡，可以安装 CUDA 来加速模型运行。

**检查是否有 GPU：**
```powershell
nvidia-smi
```

如果有输出，说明有 NVIDIA GPU，可以继续安装 CUDA。

**CUDA 下载地址：** https://developer.nvidia.com/cuda-downloads

---

## 📦 安装项目依赖

### 步骤 1：安装后端依赖

打开 PowerShell 或命令提示符，执行以下命令：

```powershell
# 进入项目目录（根据你的实际路径调整）
cd "C:\Users\32353\Desktop\大四上\NLP\CW\Hotel-Feedback-ABSA-Task-main"

# 进入后端目录
cd backend

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
.\venv\Scripts\activate

# 升级 pip
python -m pip install --upgrade pip

# 安装依赖（这可能需要几分钟，因为要下载模型库）
pip install -r requirements.txt
```

**⚠️ PowerShell 执行策略问题：**

如果遇到 "禁止运行脚本" 的错误，有两种解决方案：

**方案 1：修改执行策略（推荐）**
```powershell
# 以管理员身份运行 PowerShell，然后执行：
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

**方案 2：直接使用虚拟环境 Python（无需激活）**
```powershell
# 不需要激活虚拟环境，直接使用：
.\venv\Scripts\python.exe -m pip install -r requirements.txt
```

**注意：** 如果使用 GPU，需要先安装支持 CUDA 的 PyTorch：

```powershell
# 卸载 CPU 版本的 PyTorch（如果已安装）
pip uninstall torch torchvision torchaudio -y

# 安装 CUDA 12.1 版本的 PyTorch（适用于 CUDA 12.8）
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
```

**详细 GPU 配置请查看：`GPU配置指南.md`**

### 步骤 2：安装前端依赖

**新开一个 PowerShell 窗口**，执行：

```powershell
# 进入项目目录
cd "C:\Users\32353\Desktop\大四上\NLP\CW\Hotel-Feedback-ABSA-Task-main"

# 进入前端目录
cd frontend

# 安装依赖
npm install
```

---

## 🚀 运行程序

### 启动后端服务

在第一个 PowerShell 窗口中：

**方法 1：激活虚拟环境后启动（推荐）**
```powershell
# 进入后端目录
cd "C:\Users\32353\Desktop\大四上\NLP\CW\Hotel-Feedback-ABSA-Task-main\backend"

# 激活虚拟环境（如果执行策略已修改）
.\venv\Scripts\activate

# 启动后端服务
python app.py
```

**方法 2：直接使用虚拟环境 Python（如果无法激活）**
```powershell
# 进入后端目录
cd "C:\Users\32353\Desktop\大四上\NLP\CW\Hotel-Feedback-ABSA-Task-main\backend"

# 直接使用虚拟环境中的 Python
.\venv\Scripts\python.exe app.py
```

**成功标志：** 看到类似以下输出：
```
✅ 检测到CUDA，将使用GPU: ...
或
⚠️  未检测到CUDA，将使用CPU
 * Running on http://127.0.0.1:5000
```

后端将在 `http://localhost:5000` 运行

### 启动前端服务

**新开第二个 PowerShell 窗口**，执行：

```powershell
# 进入前端目录
cd "C:\Users\32353\Desktop\大四上\NLP\CW\Hotel-Feedback-ABSA-Task-main\frontend"

# 启动前端开发服务器
npm run dev
```

**成功标志：** 看到类似以下输出：
```
  VITE v5.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
```

前端将在 `http://localhost:5173` 运行

---

## 🌐 访问系统

1. 打开浏览器
2. 访问：`http://localhost:5173`
3. 使用默认管理员账户登录：
   - 用户名：`admin`
   - 密码：`admin123`

---

## ⚠️ 常见问题

### 问题 1：npm 命令找不到

**解决方案：** 
- 确保已安装 Node.js
- 重启命令行窗口
- 检查环境变量 PATH 是否包含 Node.js 路径

### 问题 2：pip install 很慢或失败

**解决方案：**
```powershell
# 使用国内镜像源（清华大学）
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 问题 3：模型下载很慢

**解决方案：**
- 模型会自动从 HuggingFace 下载，可能需要较长时间
- 可以手动下载模型文件到 `model/cache/Qwen--Qwen2-1.5B-Instruct/` 目录

### 问题 4：端口被占用

**解决方案：**
- 后端默认端口 5000，前端默认端口 5173
- 如果端口被占用，可以修改：
  - 后端：修改 `backend/app.py` 中的 `port=5000`
  - 前端：修改 `frontend/vite.config.js` 中的端口配置

### 问题 5：数据库错误

**解决方案：**
- 删除 `data/hotel_feedback.db` 文件
- 重新启动后端，会自动创建新数据库

### 问题 6：PowerShell 执行策略错误

**错误信息：** `无法加载文件 ... Activate.ps1，因为在此系统上禁止运行脚本`

**解决方案：**

**方法 1：修改执行策略（推荐）**
```powershell
# 以管理员身份运行 PowerShell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

**方法 2：直接使用虚拟环境 Python（无需激活）**
```powershell
# 不需要激活，直接使用：
.\venv\Scripts\python.exe app.py
```

### 问题 7：GPU 未检测到

**解决方案：**
1. 确认已安装 CUDA 版本的 PyTorch（见上方 GPU 配置）
2. 运行验证命令：
   ```powershell
   python -c "import torch; print(f'CUDA 可用: {torch.cuda.is_available()}')"
   ```
3. 详细步骤请查看 `GPU配置指南.md`

---

## 📝 快速命令总结

**安装依赖：**
```powershell
# 后端
cd backend
python -m venv venv
.\venv\Scripts\activate
pip install -r requirements.txt

# 前端
cd frontend
npm install
```

**运行程序：**
```powershell
# 后端（终端1）- 方法1：激活虚拟环境
cd backend
.\venv\Scripts\activate
python app.py

# 后端（终端1）- 方法2：直接使用（如果无法激活）
cd backend
.\venv\Scripts\python.exe app.py

# 前端（终端2）
cd frontend
npm run dev
```

**GPU 用户额外步骤：**
```powershell
# 1. 卸载 CPU 版本 PyTorch
cd backend
pip uninstall torch torchvision torchaudio -y

# 2. 安装 CUDA 版本 PyTorch
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

# 3. 验证 GPU
python -c "import torch; print(f'CUDA: {torch.cuda.is_available()}')"
```

---

## 📞 需要帮助？

如果遇到问题，请检查：
1. Python 版本是否为 3.8+
2. Node.js 是否已正确安装
3. 所有依赖是否已安装完成
4. 后端和前端是否都已启动

